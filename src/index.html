<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drug Trial eCRF | Imperial CTU</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-logo">
                <img src="logo.png" alt="Imperial CTU Logo" class="logo">
            </div>
            <div class="header-text">
                <h1>Electronic Case Report Form (eCRF)</h1>
                <h2>Study Protocol: ICTU-2025-DR3 | Hypertension Drug Trial</h2>
            </div>
        </header>

        <div class="form-metadata">
            <p><strong>Form Version:</strong> 2.1.3</p>
            <p><strong>Last Updated:</strong> 12-Apr-2025</p>
        </div>

        <form id="drug-trial-form">
            <!-- Screening & Eligibility Section -->
            <div class="form-section" id="eligibility-section">
                <h3>Screening & Eligibility</h3>
                
                <div class="form-group">
                    <label for="screening-id">Screening ID* <span class="hint">(Format: SCR-12345)</span></label>
                    <input type="text" id="screening-id" name="screeningId" pattern="SCR-\d{5}" required data-cy="screening-id">
                    <div class="error-message" id="screening-id-error"></div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="screening-date">Screening Date*</label>
                        <input type="date" id="screening-date" name="screeningDate" required data-cy="screening-date">
                        <div class="error-message" id="screening-date-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="informed-consent">Informed Consent Obtained*</label>
                        <select id="informed-consent" name="informedConsent" required data-cy="informed-consent">
                            <option value="">Select</option>
                            <option value="yes">Yes</option>
                            <option value="no">No</option>
                        </select>
                        <div class="error-message" id="informed-consent-error"></div>
                    </div>
                </div>
                
                <div class="form-section-inner">
                    <h4>Inclusion Criteria (All must be "Yes")</h4>
                    
                    <div class="checkbox-group">
                        <div class="form-check">
                            <input type="checkbox" id="inclusion-age" name="inclusionCriteria[]" value="age" required data-cy="inclusion-age">
                            <label for="inclusion-age">Age 18-75 years</label>
                        </div>
                        <div class="error-message" id="inclusion-age-error"></div>
                        
                        <div class="form-check">
                            <input type="checkbox" id="inclusion-bp" name="inclusionCriteria[]" value="bp" required data-cy="inclusion-bp">
                            <label for="inclusion-bp">Systolic BP ≥140 mmHg or Diastolic BP ≥90 mmHg</label>
                        </div>
                        <div class="error-message" id="inclusion-bp-error"></div>
                        
                        <div class="form-check">
                            <input type="checkbox" id="inclusion-treatment" name="inclusionCriteria[]" value="treatment" required data-cy="inclusion-treatment">
                            <label for="inclusion-treatment">No change in antihypertensive treatment in the past 4 weeks</label>
                        </div>
                        <div class="error-message" id="inclusion-treatment-error"></div>
                        
                        <div class="form-check">
                            <input type="checkbox" id="inclusion-willing" name="inclusionCriteria[]" value="willing" required data-cy="inclusion-willing">
                            <label for="inclusion-willing">Willing and able to comply with study procedures</label>
                        </div>
                        <div class="error-message" id="inclusion-willing-error"></div>
                    </div>
                </div>
                
                <div class="form-section-inner">
                    <h4>Exclusion Criteria (All must be "No")</h4>
                    
                    <div class="checkbox-group">
                        <div class="form-check">
                            <input type="checkbox" id="exclusion-secondary" name="exclusionCriteria[]" value="secondary" data-cy="exclusion-secondary">
                            <label for="exclusion-secondary">Secondary hypertension</label>
                        </div>
                        <div class="error-message" id="exclusion-secondary-error"></div>
                        
                        <div class="form-check">
                            <input type="checkbox" id="exclusion-pregnancy" name="exclusionCriteria[]" value="pregnancy" data-cy="exclusion-pregnancy">
                            <label for="exclusion-pregnancy">Pregnancy or breastfeeding</label>
                        </div>
                        <div class="error-message" id="exclusion-pregnancy-error"></div>
                        
                        <div class="form-check">
                            <input type="checkbox" id="exclusion-liver" name="exclusionCriteria[]" value="liver" data-cy="exclusion-liver">
                            <label for="exclusion-liver">Severe hepatic impairment</label>
                        </div>
                        <div class="error-message" id="exclusion-liver-error"></div>
                        
                        <div class="form-check">
                            <input type="checkbox" id="exclusion-renal" name="exclusionCriteria[]" value="renal" data-cy="exclusion-renal">
                            <label for="exclusion-renal">Severe renal impairment (eGFR <30 mL/min)</label>
                        </div>
                        <div class="error-message" id="exclusion-renal-error"></div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="eligibility-status">Eligibility Status*</label>
                        <select id="eligibility-status" name="eligibilityStatus" required data-cy="eligibility-status">
                            <option value="">Select</option>
                            <option value="eligible">Eligible - Proceed to Randomization</option>
                            <option value="ineligible">Ineligible - Screen Failure</option>
                        </select>
                        <div class="error-message" id="eligibility-status-error"></div>
                    </div>
                </div>
            </div>

            <!-- Patient Information Section -->
            <div class="form-section" id="patient-section">
                <h3>Patient Information</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="participant-id">Participant ID* <span class="hint">(Format: PT-12345)</span></label>
                        <input type="text" id="participant-id" name="participantId" pattern="PT-\d{5}" required data-cy="participant-id">
                        <div class="error-message" id="participant-id-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="participant-initials">Initials* <span class="hint">(Format: AB)</span></label>
                        <input type="text" id="participant-initials" name="participantInitials" pattern="[A-Z]{2,3}" maxlength="3" required data-cy="participant-initials">
                        <div class="error-message" id="participant-initials-error"></div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="date-of-birth">Date of Birth*</label>
                        <input type="date" id="date-of-birth" name="dateOfBirth" required data-cy="date-of-birth">
                        <div class="error-message" id="date-of-birth-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="gender">Sex*</label>
                        <select id="gender" name="gender" required data-cy="gender">
                            <option value="">Select</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                        </select>
                        <div class="error-message" id="gender-error"></div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="height">Height* <span class="hint">cm</span></label>
                        <input type="number" id="height" name="height" min="120" max="220" required data-cy="height">
                        <div class="error-message" id="height-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="weight">Weight* <span class="hint">kg</span></label>
                        <input type="number" id="weight" name="weight" min="30" max="250" step="0.1" required data-cy="weight">
                        <div class="error-message" id="weight-error"></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="medical-history">Relevant Medical History</label>
                    <textarea id="medical-history" name="medicalHistory" rows="3" data-cy="medical-history"></textarea>
                </div>
            </div>

            <!-- Randomization Section -->
            <div class="form-section" id="randomization-section">
                <h3>Randomization</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="randomization-date">Randomization Date*</label>
                        <input type="date" id="randomization-date" name="randomizationDate" required data-cy="randomization-date">
                        <div class="error-message" id="randomization-date-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="randomization-number">Randomization Number*</label>
                        <input type="text" id="randomization-number" name="randomizationNumber" pattern="R\d{4}" required data-cy="randomization-number" placeholder="R0000">
                        <div class="error-message" id="randomization-number-error"></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="treatment-arm">Treatment Arm*</label>
                    <select id="treatment-arm" name="treatmentArm" required data-cy="treatment-arm">
                        <option value="">Select</option>
                        <option value="a">Arm A - Study Drug</option>
                        <option value="b">Arm B - Control</option>
                    </select>
                    <div class="error-message" id="treatment-arm-error"></div>
                </div>
                
                <div class="form-group">
                    <label for="study-kit-number">Study Kit Number Assigned*</label>
                    <input type="text" id="study-kit-number" name="studyKitNumber" pattern="KIT-\d{5}" required data-cy="study-kit-number" placeholder="KIT-00000">
                    <div class="error-message" id="study-kit-error"></div>
                </div>
            </div>

            <!-- Baseline Vital Signs Section -->
            <div class="form-section" id="vitals-section">
                <h3>Baseline Vital Signs</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="bp-systolic-1">Blood Pressure Reading 1 (Systolic)* <span class="hint">mmHg</span></label>
                        <input type="number" id="bp-systolic-1" name="bpSystolic1" min="70" max="250" required data-cy="bp-systolic-1">
                        <div class="error-message" id="bp-systolic-1-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="bp-diastolic-1">Blood Pressure Reading 1 (Diastolic)* <span class="hint">mmHg</span></label>
                        <input type="number" id="bp-diastolic-1" name="bpDiastolic1" min="40" max="150" required data-cy="bp-diastolic-1">
                        <div class="error-message" id="bp-diastolic-1-error"></div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="bp-systolic-2">Blood Pressure Reading 2 (Systolic)* <span class="hint">mmHg</span></label>
                        <input type="number" id="bp-systolic-2" name="bpSystolic2" min="70" max="250" required data-cy="bp-systolic-2">
                        <div class="error-message" id="bp-systolic-2-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="bp-diastolic-2">Blood Pressure Reading 2 (Diastolic)* <span class="hint">mmHg</span></label>
                        <input type="number" id="bp-diastolic-2" name="bpDiastolic2" min="40" max="150" required data-cy="bp-diastolic-2">
                        <div class="error-message" id="bp-diastolic-2-error"></div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="bp-systolic-3">Blood Pressure Reading 3 (Systolic)* <span class="hint">mmHg</span></label>
                        <input type="number" id="bp-systolic-3" name="bpSystolic3" min="70" max="250" required data-cy="bp-systolic-3">
                        <div class="error-message" id="bp-systolic-3-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="bp-diastolic-3">Blood Pressure Reading 3 (Diastolic)* <span class="hint">mmHg</span></label>
                        <input type="number" id="bp-diastolic-3" name="bpDiastolic3" min="40" max="150" required data-cy="bp-diastolic-3">
                        <div class="error-message" id="bp-diastolic-3-error"></div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group calculated-field">
                        <label for="bp-systolic-avg">Average Systolic BP <span class="hint">mmHg</span></label>
                        <input type="number" id="bp-systolic-avg" name="bpSystolicAvg" readonly data-cy="bp-systolic-avg">
                    </div>
                    
                    <div class="form-group calculated-field">
                        <label for="bp-diastolic-avg">Average Diastolic BP <span class="hint">mmHg</span></label>
                        <input type="number" id="bp-diastolic-avg" name="bpDiastolicAvg" readonly data-cy="bp-diastolic-avg">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="heart-rate">Heart Rate* <span class="hint">bpm</span></label>
                        <input type="number" id="heart-rate" name="heartRate" min="40" max="200" required data-cy="heart-rate">
                        <div class="error-message" id="heart-rate-error"></div>
                    </div>
                </div>
            </div>

            <!-- Laboratory Tests Section -->
            <div class="form-section" id="labs-section">
                <h3>Laboratory Tests</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="lab-date">Sample Collection Date*</label>
                        <input type="date" id="lab-date" name="labDate" required data-cy="lab-date">
                        <div class="error-message" id="lab-date-error"></div>   
                    </div>
                    
                    <div class="form-group">
                        <label for="lab-time">Sample Collection Time*</label>
                        <input type="time" id="lab-time" name="labTime" required data-cy="lab-time">
                        <div class="error-message" id="lab-time-error"></div>
                    </div>
                </div>
                
                <div class="lab-results">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="serum-creatinine">Serum Creatinine* <span class="hint">μmol/L</span></label>
                            <input type="number" id="serum-creatinine" name="serumCreatinine" min="20" max="1500" required data-cy="serum-creatinine">
                            <div class="error-message" id="serum-creatinine-error"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="egfr">eGFR* <span class="hint">mL/min/1.73m²</span></label>
                            <input type="number" id="egfr" name="egfr" min="10" max="150" required data-cy="egfr">
                            <div class="error-message" id="egfr-error"></div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="alt">ALT* <span class="hint">U/L</span></label>
                            <input type="number" id="alt" name="alt" min="0" max="1000" required data-cy="alt">
                            <div class="error-message" id="alt-error"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="ast">AST* <span class="hint">U/L</span></label>
                            <input type="number" id="ast" name="ast" min="0" max="1000" required data-cy="ast">
                            <div class="error-message" id="ast-error"></div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="sodium">Sodium* <span class="hint">mmol/L</span></label>
                            <input type="number" id="sodium" name="sodium" min="120" max="160" required data-cy="sodium">
                            <div class="error-message" id="sodium-error"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="potassium">Potassium* <span class="hint">mmol/L</span></label>
                            <input type="number" id="potassium" name="potassium" min="2.5" max="7.0" step="0.1" required data-cy="potassium">
                            <div class="error-message" id="potassium-error"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Study Drug Administration -->
            <div class="form-section" id="drug-administration-section">
                <h3>Study Drug Administration</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="drug-dispensed-date">Date Dispensed*</label>
                        <input type="date" id="drug-dispensed-date" name="drugDispensedDate" required data-cy="drug-dispensed-date">
                        <div class="error-message" id="drug-dispensed-date-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="drug-batch-number">Batch Number*</label>
                        <input type="text" id="drug-batch-number" name="drugBatchNumber" required data-cy="drug-batch-number" pattern="[A-Z0-9]{8}">
                        <div class="error-message" id="drug-batch-number-error"></div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="drug-quantity">Quantity Dispensed* <span class="hint">tablets</span></label>
                        <input type="number" id="drug-quantity" name="drugQuantity" min="1" max="100" required data-cy="drug-quantity">
                        <div class="error-message" id="drug-quantity-error"></div>
                    </div>
                    
                    <div class="form-group">
                        <label for="drug-strength">Dose Strength*</label>
                        <select id="drug-strength" name="drugStrength" required data-cy="drug-strength">
                            <option value="">Select</option>
                            <option value="5">5 mg</option>
                            <option value="10">10 mg</option>
                            <option value="20">20 mg</option>
                        </select>
                        <div class="error-message" id="drug-strength-error"></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="dosing-instructions">Dosing Instructions*</label>
                    <textarea id="dosing-instructions" name="dosingInstructions" rows="2" required data-cy="dosing-instructions"></textarea>
                    <div class="error-message" id="dosing-instructions-error"></div>
                </div>
                
                <div class="form-group">
                    <label>Dosing Time*</label>
                    <div class="radio-group" data-cy="dosing-time">
                        <label>
                            <input type="radio" name="dosingTime" value="morning" required> Morning
                        </label>
                        <label>
                            <input type="radio" name="dosingTime" value="evening" required> Evening
                        </label>
                    </div>
                    <div class="error-message" id="dosing-time-error"></div>
                </div>
            </div>

            <!-- Concomitant Medications -->
            <div class="form-section" id="conmeds-section">
                <h3>Concomitant Medications</h3>
                
                <div class="form-group">
                    <label>Is the participant taking any other medications?*</label>
                    <div class="radio-group" data-cy="has-conmeds">
                        <label>
                            <input type="radio" name="hasConmeds" value="yes" id="has-conmeds-yes" required> Yes
                        </label>
                        <label>
                            <input type="radio" name="hasConmeds" value="no" id="has-conmeds-no" required> No
                        </label>
                    </div>
                    <div class="error-message" id="has-conmeds-error"></div>
                </div>
                
                <div class="conditional-section" id="conmeds-details-section">
                    <div class="conmed-entry">
                        <div class="form-group">
                            <label for="conmed-name-1">Medication Name*</label>
                            <input type="text" id="conmed-name-1" name="conmedName[]" data-cy="conmed-name-1">
                            <div class="error-message" id="conmed-name-1-error"></div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="conmed-dose-1">Dose*</label>
                                <input type="text" id="conmed-dose-1" name="conmedDose[]" data-cy="conmed-dose-1">
                                <div class="error-message" id="conmed-dose-1-error"></div>
                            </div>
                            
                            <div class="form-group">
                                <label for="conmed-frequency-1">Frequency*</label>
                                <select id="conmed-frequency-1" name="conmedFrequency[]" data-cy="conmed-frequency-1">
                                    <option value="">Select</option>
                                    <option value="once-daily">Once Daily</option>
                                    <option value="twice-daily">Twice Daily</option>
                                    <option value="three-times-daily">Three Times Daily</option>
                                    <option value="four-times-daily">Four Times Daily</option>
                                    <option value="as-needed">As Needed</option>
                                    <option value="other">Other</option>
                                </select>
                                <div class="error-message" id="conmed-frequency-1-error"></div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="conmed-start-1">Start Date*</label>
                                <input type="date" id="conmed-start-1" name="conmedStart[]" data-cy="conmed-start-1">
                                <div class="error-message" id="conmed-start-1-error"></div>
                            </div>
                            
                            <div class="form-group">
                                <label for="conmed-indication-1">Indication*</label>
                                <input type="text" id="conmed-indication-1" name="conmedIndication[]" data-cy="conmed-indication-1">
                                <div class="error-message" id="conmed-indication-1-error"></div>
                            </div>
                        </div>
                    </div>
                    
                    <button type="button" id="add-conmed" class="secondary-button" data-cy="add-conmed">+ Add Another Medication</button>
                </div>
            </div>

            <!-- Investigator Assessment -->
            <div class="form-section" id="investigator-section">
                <h3>Investigator Assessment</h3>
                
                <div class="form-group">
                    <label for="protocol-deviations">Protocol Deviations</label>
                    <textarea id="protocol-deviations" name="protocolDeviations" rows="3" data-cy="protocol-deviations"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="investigator-comments">Investigator Comments</label>
                    <textarea id="investigator-comments" name="investigatorComments" rows="3" data-cy="investigator-comments"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="investigator-name">Investigator Name*</label>
                    <input type="text" id="investigator-name" name="investigatorName" required data-cy="investigator-name">
                    <div class="error-message" id="investigator-name-error"></div>
                </div>
                
                <div class="form-group">
                    <label for="signature-date">Date of Signature*</label>
                    <input type="date" id="signature-date" name="signatureDate" required data-cy="signature-date">
                    <div class="error-message" id="signature-date-error"></div>
                </div>
                
                <div class="form-group">
                    <label for="declaration">Declaration*</label>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="declaration" name="declaration" required data-cy="declaration">
                            I confirm that I have examined the participant and the information in this eCRF is accurate and complete to the best of my knowledge.
                        </label>
                    </div>
                    <div class="error-message" id="declaration-error"></div>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
                <button type="button" class="secondary-button" id="save-draft" data-cy="save-draft">Save as Draft</button>
                <button type="button" class="secondary-button" id="validate-form" data-cy="validate-form">Validate Form</button>
                <button type="submit" class="primary-button" id="submit-form" data-cy="submit-form">Submit Form</button>
            </div>
        </form>

        <div id="form-validation-results" class="hidden">
            <h3>Form Validation Results</h3>
            <ul id="validation-message-list"></ul>
            <button type="button" class="secondary-button" id="close-validation" data-cy="close-validation">Close</button>
        </div>

        <div id="success-message" class="hidden">
            <h3>Form Submitted Successfully!</h3>
            <p>The eCRF has been successfully submitted to the EDC system.</p>
            <p><strong>Reference Number:</strong> <span id="reference-number"></span></p>
            <p><strong>Submission Date/Time:</strong> <span id="submission-datetime"></span></p>
            <button type="button" class="primary-button" id="new-form" data-cy="new-form">Create New Form</button>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>